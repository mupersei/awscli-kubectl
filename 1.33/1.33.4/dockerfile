FROM ubuntu:24.04

ARG KUBECTL_VERSION
ARG TARGETARCH

RUN apt-get update && \
    apt-get install -y curl unzip ca-certificates less groff && \
    rm -rf /var/lib/apt/lists/*

RUN set -eux; \
    if [ "$TARGETARCH" = "amd64" ]; then \
        curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"; \
    elif [ "$TARGETARCH" = "arm64" ]; then \
        curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip"; \
    else \
        echo "Architecture $TARGETARCH is not supported for AWS CLI." >&2; exit 1; \
    fi; \
    unzip awscliv2.zip; \
    ./aws/install; \
    rm -rf aws awscliv2.zip

RUN set -eux; \
    if [ -z "$KUBECTL_VERSION" ]; then \
        echo "KUBECTL_VERSION build argument is required." >&2; exit 1; \
    fi; \
    if [ "$TARGETARCH" = "amd64" ]; then \
        curl -LO "https://dl.k8s.io/release/v${KUBECTL_VERSION}/bin/linux/amd64/kubectl"; \
    elif [ "$TARGETARCH" = "arm64" ]; then \
        curl -LO "https://dl.k8s.io/release/v${KUBECTL_VERSION}/bin/linux/arm64/kubectl"; \
    else \
        echo "Architecture $TARGETARCH is not supported." >&2; exit 1; \
    fi; \
    chmod +x kubectl; \
    mv kubectl /usr/local/bin/kubectl

CMD ["/bin/bash"]